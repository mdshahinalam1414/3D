<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sci-Fi History Timeline</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

body{
  margin:0;
  font-family:'Orbitron',sans-serif;
  background: radial-gradient(circle at center,#050510,#000000 60%);
  color:#00ffff;
  overflow:hidden;
}

/* ===== Background Canvases ===== */
#bgCanvas{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:-2;
}

#gridCanvas{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:-1;
  opacity:0.25;
}

/* ===== Sidebar ===== */
.sidebar{
  position:fixed;
  left:0;
  top:0;
  width:260px;
  height:100%;
  background:rgba(0,0,0,0.85);
  box-shadow:0 0 30px #0ff;
  padding:20px;
  overflow-y:auto;
  z-index:10;
}

.sidebar input,
.sidebar textarea,
.sidebar button{
  width:100%;
  margin:6px 0;
  padding:7px;
  border-radius:8px;
  border:none;
  background:rgba(0,0,0,0.4);
  color:#0ff;
  font-size:12px;
}

.sidebar button{
  background:#00ffff;
  color:black;
  font-weight:bold;
  cursor:pointer;
}

/* ===== Timeline ===== */
.timeline-area{
  position:absolute;
  left:260px;
  top:0;
  width:calc(100% - 260px);
  height:100%;
  overflow-x:auto;
}

.timeline-wrapper{
  position:relative;
  height:100%;
  min-width:4000px;
}

.main-line{
  position:absolute;
  top:50%;
  left:0;
  height:4px;
  width:100%;
  background:#00ffff;
  box-shadow:0 0 20px #0ff;
}

/* ===== Event Box ===== */
.event{
  position:absolute;
  width:190px;
  padding:10px;
  border-radius:12px;
  background:rgba(0,15,25,0.9);
  border:1px solid rgba(0,255,255,0.5);
  box-shadow:0 0 15px #0ff;
  font-size:11px;
  transition:0.3s;
}

.event img{
  width:100%;
  height:70px;
  object-fit:cover;
  border-radius:8px;
  margin-top:5px;
}

.event:hover{
  transform:scale(1.05);
  box-shadow:0 0 35px #0ff;
}

.branch{
  position:absolute;
  width:2px;
  background:#00ffff;
  box-shadow:0 0 10px #0ff;
}

.special{
  background:#001f2f;
  color:#fffc00;
  text-align:center;
  font-weight:bold;
}
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>
<canvas id="gridCanvas"></canvas>

<div class="sidebar">
  <h3>Admin Panel</h3>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginMsg" style="color:red;"></p>

  <div id="eventForm" style="display:none;">
    <hr>
    <input type="date" id="startDate" required>
    <input type="date" id="endDate">
    <input type="text" id="title" placeholder="Title">
    <textarea id="desc" placeholder="Description"></textarea>
    <input type="url" id="image" placeholder="Image URL">
    <button onclick="addEvent()">Add Event</button>
  </div>
</div>

<div class="timeline-area">
  <div class="timeline-wrapper" id="wrapper">
    <div class="main-line"></div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz8udTa8QlNDsxIOboxBQx1ciXQhZWUqjsHYb2WTk1Lai9gc15YgZMnVJbEgbGYwvVG/exec";
const adminUser = "admin";
const adminPass = "1234";

let events = [];

/* ===== Login ===== */
function login(){
  if(username.value === adminUser && password.value === adminPass){
    eventForm.style.display = "block";
    loginMsg.textContent = "";
  } else {
    loginMsg.textContent = "Invalid Login!";
  }
}

/* ===== Fetch Events from Google Sheet ===== */
async function fetchEventsFromSheet(){
  try{
    const res = await fetch(SHEET_URL);
    const data = await res.json();
    events = data;
    renderTimeline();
  } catch(err){
    console.error("Sheet fetch error:", err);
  }
}

/* ===== Add Event (POST to Sheet) ===== */
async function addEvent(){
  if(!startDate.value) return;

  const newEvent = {
    start: startDate.value,
    end: endDate.value || null,
    title: title.value,
    desc: desc.value,
    image: image.value
  };

  try{
    await fetch(SHEET_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(newEvent)
    });
    // Reload from sheet after adding
    fetchEventsFromSheet();
  } catch(err){
    console.error("Add event error:", err);
  }

  // Clear form
  startDate.value = "";
  endDate.value = "";
  title.value = "";
  desc.value = "";
  image.value = "";
}

/* ===== Render Timeline ===== */
function renderTimeline(){
  if(events.length === 0) return;

  events.sort((a,b)=> new Date(a.start) - new Date(b.start));
  wrapper.querySelectorAll(".event,.branch").forEach(e=>e.remove());

  const spacing = 450;

  createNode("START", events[0].start, 0, true);

  events.forEach((ev,i)=>{
    let dateText = ev.end ? ev.start+" â†’ "+ev.end : ev.start;
    createNode(ev.title, dateText+"<br>"+ev.desc, (i+1)*spacing, false, i, ev.image);
  });

  createNode("END", events[events.length-1].end || events[events.length-1].start, (events.length+1)*spacing, true);
}

/* ===== Create Event Node ===== */
function createNode(title,text,leftPos,isSpecial,index=0,img=""){
  const node=document.createElement("div");
  node.className="event"+(isSpecial?" special":"");
  node.style.left=leftPos+"px";

  let isTop = index%2===0;
  node.style.top = isSpecial ? "45%" : (isTop ? "12%" : "78%");

  node.innerHTML=`<strong>${title}</strong><br>${text}`;

  if(img){
    const imageTag=document.createElement("img");
    imageTag.src=img;
    node.appendChild(imageTag);
  }

  wrapper.appendChild(node);

  if(!isSpecial){
    const branch=document.createElement("div");
    branch.className="branch";
    branch.style.left=(leftPos+95)+"px";
    branch.style.top="50%";
    branch.style.height="140px";
    if(isTop) branch.style.transform="translateY(-140px)";
    wrapper.appendChild(branch);
  }
}

/* ===== Ultra Futuristic Background ===== */
const bgCanvas=document.getElementById("bgCanvas");
const bgCtx=bgCanvas.getContext("2d");
const gridCanvas=document.getElementById("gridCanvas");
const gridCtx=gridCanvas.getContext("2d");

function resize(){
  bgCanvas.width = window.innerWidth;
  bgCanvas.height = window.innerHeight;
  gridCanvas.width = window.innerWidth;
  gridCanvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* Particles */
let particles=[];
for(let i=0;i<180;i++){
  particles.push({
    x:Math.random()*bgCanvas.width,
    y:Math.random()*bgCanvas.height,
    vx:(Math.random()-0.5)*1,
    vy:(Math.random()-0.5)*1,
    r:Math.random()*2+1
  });
}

/* Grid */
let gridOffset=0;
function drawGrid(){
  gridCtx.clearRect(0,0,gridCanvas.width,gridCanvas.height);
  gridCtx.strokeStyle="#00ffff";
  gridCtx.lineWidth=1;
  const gap=40;
  gridOffset+=0.5;
  for(let x=0;x<gridCanvas.width;x+=gap){
    gridCtx.beginPath();
    gridCtx.moveTo(x+gridOffset%gap,0);
    gridCtx.lineTo(x+gridOffset%gap,gridCanvas.height);
    gridCtx.stroke();
  }
  for(let y=0;y<gridCanvas.height;y+=gap){
    gridCtx.beginPath();
    gridCtx.moveTo(0,y+gridOffset%gap);
    gridCtx.lineTo(gridCanvas.width,y+gridOffset%gap);
    gridCtx.stroke();
  }
}

/* Glow Pulse */
let glow=0;
let glowDir=0.02;
function animate(){
  bgCtx.clearRect(0,0,bgCanvas.width,bgCanvas.height);
  glow+=glowDir;
  if(glow>1||glow<0) glowDir*=-1;
  let gradient=bgCtx.createRadialGradient(
    bgCanvas.width/2,
    bgCanvas.height/2,
    200,
    bgCanvas.width/2,
    bgCanvas.height/2,
    1000
  );
  gradient.addColorStop(0,"rgba(0,255,255,"+(0.2+glow*0.3)+")");
  gradient.addColorStop(1,"transparent");
  bgCtx.fillStyle=gradient;
  bgCtx.fillRect(0,0,bgCanvas.width,bgCanvas.height);

  particles.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    if(p.x<0||p.x>bgCanvas.width)p.vx*=-1;
    if(p.y<0||p.y>bgCanvas.height)p.vy*=-1;
    bgCtx.beginPath();
    bgCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
    bgCtx.fillStyle="#00ffff";
    bgCtx.shadowBlur=25;
    bgCtx.shadowColor="#00ffff";
    bgCtx.fill();
    bgCtx.shadowBlur=0;
  });

  drawGrid();
  requestAnimationFrame(animate);
}
animate();

/* ===== Fetch Sheet on Load ===== */
fetchEventsFromSheet();

</script>
</body>
</html>


